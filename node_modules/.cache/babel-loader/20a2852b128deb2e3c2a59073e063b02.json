{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _libs = require('../../libs');\n\nvar _Cover = require('./Cover');\n\nvar _Cover2 = _interopRequireDefault(_Cover);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\n(function () {\n  var enterModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).enterModule;\n  enterModule && enterModule(module);\n})();\n\nvar IframeUpload = function (_Component) {\n  (0, _inherits3.default)(IframeUpload, _Component);\n\n  function IframeUpload(props) {\n    (0, _classCallCheck3.default)(this, IframeUpload);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (IframeUpload.__proto__ || Object.getPrototypeOf(IframeUpload)).call(this, props));\n\n    _this.state = {\n      dragOver: false,\n      file: null,\n      disabled: false,\n      frameName: 'frame-' + Date.now()\n    };\n    return _this;\n  }\n\n  (0, _createClass3.default)(IframeUpload, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      var _props = this.props,\n          action = _props.action,\n          onSuccess = _props.onSuccess,\n          onError = _props.onError;\n      var file = this.state.file;\n      window.addEventListener('message', function (event) {\n        var _ref = new URL(action),\n            origin = _ref.origin;\n\n        if (event.origin !== origin) return false;\n        var response = event.data;\n\n        if (response.result === 'success') {\n          onSuccess(response, file);\n        } else if (response.result === 'failed') {\n          onError(response, file);\n        }\n      }, false);\n    }\n  }, {\n    key: 'onload',\n    value: function onload() {\n      this.setState({\n        disabled: false\n      });\n    }\n  }, {\n    key: 'onDrop',\n    value: function onDrop(e) {\n      e.preventDefault();\n      this.setState({\n        dragOver: false\n      });\n      this.uploadFiles(e.dataTransfer.files); // TODO\n    }\n  }, {\n    key: 'handleChange',\n    value: function handleChange(e) {\n      if (e.target instanceof HTMLInputElement) {\n        var file = e.target.files[0];\n\n        if (file) {\n          this.uploadFiles(file);\n        }\n      }\n    }\n  }, {\n    key: 'uploadFiles',\n    value: function uploadFiles(file) {\n      if (this.state.disabled) return;\n      this.setState({\n        disabled: false,\n        file: file\n      });\n      this.props.onStart && this.props.onStart(file);\n      var formNode = this.refs.form;\n      var dataSpan = this.refs.data;\n      var data = this.props.data;\n\n      if (typeof data === 'function') {\n        data = data(file);\n      }\n\n      var inputs = Object.keys(data).map(function (key) {\n        return '<input name=\"' + key + '\" value=\"' + data[key] + '\"/>';\n      });\n      dataSpan.innerHTML = inputs.join('');\n      formNode.submit();\n      dataSpan.innerHTML = '';\n    }\n  }, {\n    key: 'handleClick',\n    value: function handleClick() {\n      if (!this.state.disabled) {\n        this.refs.input.click();\n      }\n    }\n  }, {\n    key: 'handleDragover',\n    value: function handleDragover(e) {\n      e.preventDefault();\n      this.setState({\n        onDrop: true\n      });\n    }\n  }, {\n    key: 'handleDragleave',\n    value: function handleDragleave(e) {\n      e.preventDefault();\n      this.setState({\n        onDrop: false\n      });\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this2 = this;\n\n      var _props2 = this.props,\n          drag = _props2.drag,\n          action = _props2.action,\n          name = _props2.name,\n          accept = _props2.accept,\n          listType = _props2.listType;\n      var frameName = this.state.frameName;\n      var classes = this.classNames((0, _defineProperty3.default)({\n        'el-upload': true\n      }, 'el-upload--' + listType, true));\n      return _react2.default.createElement('div', {\n        className: classes,\n        onClick: function onClick() {\n          return _this2.handleClick();\n        },\n        onDrop: function onDrop(e) {\n          return _this2.onDrop(e);\n        },\n        onDragOver: function onDragOver(e) {\n          return _this2.handleDragover(e);\n        },\n        onDragLeave: function onDragLeave(e) {\n          return _this2.handleDragleave(e);\n        }\n      }, _react2.default.createElement('iframe', {\n        onLoad: function onLoad() {\n          return _this2.onload();\n        },\n        ref: 'iframe',\n        name: frameName\n      }), _react2.default.createElement('form', {\n        ref: 'form',\n        action: action,\n        target: frameName,\n        encType: 'multipart/form-data',\n        method: 'POST'\n      }, _react2.default.createElement('input', {\n        className: 'el-upload__input',\n        type: 'file',\n        ref: 'input',\n        name: name,\n        onChange: function onChange(e) {\n          return _this2.handleChange(e);\n        },\n        accept: accept\n      }), _react2.default.createElement('input', {\n        type: 'hidden',\n        name: 'documentDomain',\n        value: document.domain\n      }), _react2.default.createElement('span', {\n        ref: 'data'\n      })), drag ? _react2.default.createElement(_Cover2.default, {\n        onFile: function onFile(file) {\n          return _this2.uploadFiles(file);\n        }\n      }, this.props.children) : this.props.children);\n    }\n  }, {\n    key: '__reactstandin__regenerateByEval',\n    // @ts-ignore\n    value: function __reactstandin__regenerateByEval(key, code) {\n      // @ts-ignore\n      this[key] = eval(code);\n    }\n  }]);\n  return IframeUpload;\n}(_libs.Component);\n\nIframeUpload.defaultProps = {\n  name: 'file'\n};\nvar _default = IframeUpload;\nexports.default = _default;\nIframeUpload.propTypes = {\n  drag: _libs.PropTypes.bool,\n  data: _libs.PropTypes.object,\n  action: _libs.PropTypes.string.isRequired,\n  name: _libs.PropTypes.string,\n  accept: _libs.PropTypes.string,\n  onStart: _libs.PropTypes.func,\n  onSuccess: _libs.PropTypes.func,\n  onError: _libs.PropTypes.func,\n  listType: _libs.PropTypes.string\n};\n;\n\n(function () {\n  var reactHotLoader = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).default;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(IframeUpload, 'IframeUpload', 'src/upload/iFrameUpload.jsx');\n  reactHotLoader.register(_default, 'default', 'src/upload/iFrameUpload.jsx');\n})();\n\n;\n\n(function () {\n  var leaveModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).leaveModule;\n  leaveModule && leaveModule(module);\n})();","map":{"version":3,"sources":["/home/flo/Projects/react/Holirate/node_modules/element-react/dist/npm/es5/src/upload/iFrameUpload.js"],"names":["Object","defineProperty","exports","value","_defineProperty2","require","_defineProperty3","_interopRequireDefault","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","_possibleConstructorReturn2","_possibleConstructorReturn3","_inherits2","_inherits3","_react","_react2","_libs","_Cover","_Cover2","obj","__esModule","default","enterModule","reactHotLoaderGlobal","module","IframeUpload","_Component","props","_this","__proto__","getPrototypeOf","call","state","dragOver","file","disabled","frameName","Date","now","key","componentDidMount","_props","action","onSuccess","onError","window","addEventListener","event","_ref","URL","origin","response","data","result","onload","setState","onDrop","e","preventDefault","uploadFiles","dataTransfer","files","handleChange","target","HTMLInputElement","onStart","formNode","refs","form","dataSpan","inputs","keys","map","innerHTML","join","submit","handleClick","input","click","handleDragover","handleDragleave","render","_this2","_props2","drag","name","accept","listType","classes","classNames","createElement","className","onClick","onDragOver","onDragLeave","onLoad","ref","encType","method","type","onChange","document","domain","onFile","children","__reactstandin__regenerateByEval","code","eval","Component","defaultProps","_default","propTypes","PropTypes","bool","object","string","isRequired","func","reactHotLoader","register","leaveModule"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _libs = require('../../libs');\n\nvar _Cover = require('./Cover');\n\nvar _Cover2 = _interopRequireDefault(_Cover);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n(function () {\n  var enterModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).enterModule;\n  enterModule && enterModule(module);\n})();\n\nvar IframeUpload = function (_Component) {\n  (0, _inherits3.default)(IframeUpload, _Component);\n\n  function IframeUpload(props) {\n    (0, _classCallCheck3.default)(this, IframeUpload);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (IframeUpload.__proto__ || Object.getPrototypeOf(IframeUpload)).call(this, props));\n\n    _this.state = {\n      dragOver: false,\n      file: null,\n      disabled: false,\n      frameName: 'frame-' + Date.now()\n    };\n    return _this;\n  }\n\n  (0, _createClass3.default)(IframeUpload, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      var _props = this.props,\n          action = _props.action,\n          onSuccess = _props.onSuccess,\n          onError = _props.onError;\n      var file = this.state.file;\n\n      window.addEventListener('message', function (event) {\n        var _ref = new URL(action),\n            origin = _ref.origin;\n\n        if (event.origin !== origin) return false;\n        var response = event.data;\n        if (response.result === 'success') {\n          onSuccess(response, file);\n        } else if (response.result === 'failed') {\n          onError(response, file);\n        }\n      }, false);\n    }\n  }, {\n    key: 'onload',\n    value: function onload() {\n      this.setState({ disabled: false });\n    }\n  }, {\n    key: 'onDrop',\n    value: function onDrop(e) {\n      e.preventDefault();\n      this.setState({ dragOver: false });\n      this.uploadFiles(e.dataTransfer.files); // TODO\n    }\n  }, {\n    key: 'handleChange',\n    value: function handleChange(e) {\n      if (e.target instanceof HTMLInputElement) {\n        var file = e.target.files[0];\n        if (file) {\n          this.uploadFiles(file);\n        }\n      }\n    }\n  }, {\n    key: 'uploadFiles',\n    value: function uploadFiles(file) {\n      if (this.state.disabled) return;\n      this.setState({ disabled: false, file: file });\n      this.props.onStart && this.props.onStart(file);\n      var formNode = this.refs.form;\n      var dataSpan = this.refs.data;\n      var data = this.props.data;\n      if (typeof data === 'function') {\n        data = data(file);\n      }\n      var inputs = Object.keys(data).map(function (key) {\n        return '<input name=\"' + key + '\" value=\"' + data[key] + '\"/>';\n      });\n\n      dataSpan.innerHTML = inputs.join('');\n      formNode.submit();\n      dataSpan.innerHTML = '';\n    }\n  }, {\n    key: 'handleClick',\n    value: function handleClick() {\n      if (!this.state.disabled) {\n        this.refs.input.click();\n      }\n    }\n  }, {\n    key: 'handleDragover',\n    value: function handleDragover(e) {\n      e.preventDefault();\n      this.setState({ onDrop: true });\n    }\n  }, {\n    key: 'handleDragleave',\n    value: function handleDragleave(e) {\n      e.preventDefault();\n      this.setState({ onDrop: false });\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this2 = this;\n\n      var _props2 = this.props,\n          drag = _props2.drag,\n          action = _props2.action,\n          name = _props2.name,\n          accept = _props2.accept,\n          listType = _props2.listType;\n      var frameName = this.state.frameName;\n\n      var classes = this.classNames((0, _defineProperty3.default)({\n        'el-upload': true\n      }, 'el-upload--' + listType, true));\n      return _react2.default.createElement(\n        'div',\n        {\n          className: classes,\n          onClick: function onClick() {\n            return _this2.handleClick();\n          },\n          onDrop: function onDrop(e) {\n            return _this2.onDrop(e);\n          },\n          onDragOver: function onDragOver(e) {\n            return _this2.handleDragover(e);\n          },\n          onDragLeave: function onDragLeave(e) {\n            return _this2.handleDragleave(e);\n          }\n        },\n        _react2.default.createElement('iframe', { onLoad: function onLoad() {\n            return _this2.onload();\n          }, ref: 'iframe', name: frameName }),\n        _react2.default.createElement(\n          'form',\n          {\n            ref: 'form',\n            action: action,\n            target: frameName,\n            encType: 'multipart/form-data',\n            method: 'POST'\n          },\n          _react2.default.createElement('input', {\n            className: 'el-upload__input',\n            type: 'file',\n            ref: 'input',\n            name: name,\n            onChange: function onChange(e) {\n              return _this2.handleChange(e);\n            },\n            accept: accept\n          }),\n          _react2.default.createElement('input', { type: 'hidden', name: 'documentDomain', value: document.domain }),\n          _react2.default.createElement('span', { ref: 'data' })\n        ),\n        drag ? _react2.default.createElement(\n          _Cover2.default,\n          { onFile: function onFile(file) {\n              return _this2.uploadFiles(file);\n            } },\n          this.props.children\n        ) : this.props.children\n      );\n    }\n  }, {\n    key: '__reactstandin__regenerateByEval',\n    // @ts-ignore\n    value: function __reactstandin__regenerateByEval(key, code) {\n      // @ts-ignore\n      this[key] = eval(code);\n    }\n  }]);\n  return IframeUpload;\n}(_libs.Component);\n\nIframeUpload.defaultProps = {\n  name: 'file'\n};\nvar _default = IframeUpload;\nexports.default = _default;\n\n\nIframeUpload.propTypes = {\n  drag: _libs.PropTypes.bool,\n  data: _libs.PropTypes.object,\n  action: _libs.PropTypes.string.isRequired,\n  name: _libs.PropTypes.string,\n  accept: _libs.PropTypes.string,\n  onStart: _libs.PropTypes.func,\n  onSuccess: _libs.PropTypes.func,\n  onError: _libs.PropTypes.func,\n  listType: _libs.PropTypes.string\n};\n;\n\n(function () {\n  var reactHotLoader = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).default;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(IframeUpload, 'IframeUpload', 'src/upload/iFrameUpload.jsx');\n  reactHotLoader.register(_default, 'default', 'src/upload/iFrameUpload.jsx');\n})();\n\n;\n\n(function () {\n  var leaveModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).leaveModule;\n  leaveModule && leaveModule(module);\n})();"]},"metadata":{},"sourceType":"script"}